<html>

<head>
    <title>ASES</title>
    <link href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" rel="stylesheet">

    <script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.5.7/angular.min.js"></script>
    <script src="http://cdnjs.cloudflare.com/ajax/libs/angular-ui-router/0.3.2/angular-ui-router.js"></script>
    <script src="/javascripts/angularApp.js"></script>
    <link href="/stylesheets/style.css" rel="stylesheet">

</head>

<body dir="rtl" ng-app="ases">
    <nav ng-controller="NavCtrl">
        <!--<nav class="navbar navbar-default pull-right" ng-controller="NavCtrl">-->
        <ul>
            <!-- 
                href is sent to angularApp.js ->
                    app.config ->
                        $stateProvider ->
                            choose state by matching URL ->
                                return templateUrl   
            -->
            <li ng-show="isLoggedIn()"><a class="ng-binding">{{currentUser()}}</a></li>
            <li ng-show="isLoggedIn()"><a href="/#/home">תפריט ראשי</a></li>
            <li ng-show="isLoggedIn()"><a href="/#/message_board">לוח הודעות</a></li>
            <li ng-show="isLoggedIn()"><a href="/#/staff_groups">ניהול קבוצות חברי סגל</a></li>
            <li ng-show="isLoggedIn()"><a href="/#/sections">ניהול תחומי פעילות</a></li>
            <li ng-show="isLoggedIn()"><a href="/#/format_criterias">ניהול קריטריונים להערכה</a></li>
            <li ng-show="isLoggedIn()"><a href="" ng-click="logOut()">התנתקות</a></li>
            <li class="ng-hide" ng-hide="isLoggedIn()"><a href="/#/login">התחברות</a></li>
            <li class="ng-hide" ng-hide="isLoggedIn()"><a href="/#/register">הרשמה</a></li>
        </ul>
    </nav>
    <div class="row">
        <div class="col-md-6 col-md-offset-3">
            <ui-view></ui-view>
        </div>
    </div>



    <!--TEMPLATES ARE BELOW-->
    <script type="text/ng-template" id="/home.html">
        <div class="page-header">
            <h1>ASES</h1>
        </div>
        <!-- rest of template -->
        <div ng-hide="isLoggedIn()">
            <h3>You need to <a href="/#/login">Log In</a> or <a href="/#/register">Register</a> before you can add a post.</h3>
        </div>

        ברוך הבא: {{currentUser()}}


    </script>




    <script type="text/ng-template" id="/message_board.html">
        <div class="page-header">
            <h1>ASES</h1>
        </div>
        <!-- rest of template -->
        <div ng-hide="isLoggedIn()">
            <h3>You need to <a href="/#/login">Log In</a> or <a href="/#/register">Register</a> before you can add a post.</h3>
        </div>
        <div ng-repeat="post in posts | orderBy:'-upvotes'">
            <span class="glyphicon glyphicon-thumbs-up" ng-click="incrementUpvotes(post)"></span> {{post.upvotes}}
            <span style="font-size:20px; margin-left:10px;">
            <a ng-show="post.link" href="{{post.link}}">
              {{post.title}}
            </a>
            <span ng-hide="post.link">
              {{post.title}}
            </span>
            </span>
            <span ng-show="post.author">posted by <a>{{post.author}}</a> |</span>
            <span><a href="#/posts/{{post._id}}">Comments</a></span>
            <div ng-repeat="comment in post.comments | orderBy:'-upvotes'">
                <span class="glyphicon glyphicon-thumbs-up" ng-click="incrementUpvotes(comment)"></span> {{comment.upvotes}}
                - by {{comment.author}}
                <span style="font-size:20px; margin-left:10px;">
                    {{comment.body}}
                </span>
            </div>
        </div>
        <form ng-submit="addPost()" ng-show="isLoggedIn()" style="margin-top:30px;">
            <h3>Add a new post</h3>
            <div class="form-group">
                <input type="text" class="form-control" placeholder="Title" ng-model="title"></input>
            </div>
            <div class="form-group">
                <input type="text" class="form-control" placeholder="Link" ng-model="link"></input>
            </div>
            <button type="submit" class="btn btn-primary">Post</button>
        </form>
    </script>




    <script type="text/ng-template" id="/staff_groups.html">
        <div>
            <div class="page-header">
                <h1>ASES - ניהול קבוצות חברי סגל</h1>
            </div>
            <!-- rest of template -->
            <div ng-hide="isLoggedIn()">
                <h3>You need to <a href="/#/login">Log In</a> or <a href="/#/register">Register</a> before you can enter section
                    manager.
                </h3>
            </div>

            <form ng-submit="addStaffGroup()" ng-show="isLoggedIn()" style="margin-top:30px;">
                <h3>הוספת קבוצה חדשה</h3>

                <!--<div class="form-group">
                    <input type="num" class="form-control" placeholder="מספר" ng-model="group"></input>
                </div>-->
                <div class="form-group">
                    <input type="text" class="form-control" placeholder="שם" ng-model="name" ng-required="true"></input>
                </div>
                <div class="form-group">
                    <input type="text" class="form-control" placeholder="תיאור" ng-model="slug"></input>
                </div>
                <button type="submit" class="btn btn-primary">הוספה</button>
            </form>

            <div ng-repeat="staffGroup in staffGroups | orderBy:'group'">

                <div>
                    <span style="font-size:20px; margin-left:10px;">
      <span>
        <label class="label-field">מזהה קבוצה: </label>
        <input class="editable-field" ng-model="staffGroup.group" ng-disabled="!edit" value="{{staffGroup.group}}">
        <br />
      </span>
                    <span>
        <label class="label-field">שם: </label>
        <input class="editable-field" ng-model="staffGroup.name" ng-disabled="!edit" value="{{staffGroup.name}}">
        <br />
      </span>
                    <span ng-show="staffGroup.slug || edit">
        <label class="label-field">תיאור: </label>
        <input class="editable-field" ng-model="staffGroup.slug" ng-disabled="!edit" value="{{staffGroup.slug}}">
        <br />
        </span>
                    <span>
       <label>תאריך הוספה:</label> {{staffGroup.dateCreated | date:'dd/MM/yyyy - HH:mm:ss'}}
       <br />
      </span>
                    <span ng-hide="staffGroup.dateCreated===staffGroup.dateModified">
         <label>נערך לאחרונה:</label> {{staffGroup.dateModified | date:'dd/MM/yyyy - HH:mm:ss'}}
         <br />
      </span>

                    <span>
        <label>לחץ לעריכה: <input type="checkbox" ng-model="edit"></label>
        <button ng-click="editStaffGroup($index, staffGroup)" class="btn btn-primary" ng-disabled="!edit">שמור שינויים</button>
        <button ng-click="deleteStaffGroup(staffGroup)" class="btn btn-danger" ng-disabled="!edit">מחק קבוצה זו</button>
        <br />
      </span>
                    </span>

                    <!--</form>-->

                </div>
            </div>



        </div>
    </script>


    <script type="text/ng-template" id="/sections.html">
        <div>
            <div class="page-header">
                <h1>ASES - ניהול תחומי פעילות</h1>
            </div>
            <!-- rest of template -->
            <div ng-hide="isLoggedIn()">
                <h3>You need to <a href="/#/login">Log In</a> or <a href="/#/register">Register</a> before you can enter section
                    manager.
                </h3>
            </div>

            <form ng-submit="addSection()" ng-show="isLoggedIn()" style="margin-top:30px;">
                <h3>הוספת תחום פעילות חדש</h3>

                <!--<div class="form-group">
                    <input type="num" class="form-control" placeholder="מספר" ng-model="num"></input>
                </div>-->
                <div class="form-group">
                    <input type="text" class="form-control" placeholder="שם" ng-model="name" ng-required="true"></input>
                </div>
                <div class="form-group">
                    <input type="text" class="form-control" placeholder="תיאור" ng-model="slug"></input>
                </div>
                <div ng-repeat="staffGroup in staffGroups | orderBy:'group'">
                    <input type="checkbox" ng-checked="checkedStaffGroups.indexOf(staffGroup) != -1" ng-click="toggleCheck(staffGroup)" />
                    <label>{{staffGroup.group+'.'+staffGroup.name}}</label>
                </div>

                <button type="submit" class="btn btn-primary">הוספה</button>
            </form>

            ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
            <br />


            <!-- EXISTING SECTIONS -->
            <div ng-repeat="section in sections | orderBy:'num'">


                <div>
                    <span style="font-size:20px; margin-left:10px;">
                    <span>
                    <label class="label-field">מספר: </label>
                    <input class="editable-field" ng-model="section.num" ng-disabled="!edit" value="{{section.num}}">
                    <br />
                    </span>
                    <span>
        <label class="label-field">שם: </label>
        <input class="editable-field" ng-model="section.name" ng-disabled="!edit" value="{{section.name}}">
        <br />
      </span>
                    <span ng-show="section.slug || edit">
        <label class="label-field">תיאור: </label>
        <input class="editable-field" ng-model="section.slug" ng-disabled="!edit" value="{{section.slug}}">
        <br />
        </span>


                    <div ng-repeat="staffGroup in staffGroups | orderBy:'group'">
                        <!--NEED TO MAKE CHANGES TO NG-CLICK HERE-->
                        <input type="checkbox" ng-checked="staffGroupIndex(staffGroup, section.staffGroups) > -1" ng-click="toggleCheck(staffGroup, section.staffGroups)"
                            ng-disabled="!edit" /> <label>{{staffGroup.group+'.'+staffGroup.name}}</label>
                    </div>
                    <span>
        <label>תאריך הוספה:</label> {{section.dateCreated | date:'dd/MM/yyyy - HH:mm:ss'}}
        <br />
        </span>
                    <span ng-hide="section.dateCreated===section.dateModified">
         <label>נערך לאחרונה:</label> {{section.dateModified | date:'dd/MM/yyyy - HH:mm:ss'}}
         <br />
      </span>

                    <span>
        <label>לחץ לעריכה: <input type="checkbox" ng-model="edit"></label>
        <button ng-click="editSection($index, section)" class="btn btn-primary" ng-disabled="!edit">שמור שינויים</button>
        <button ng-click="deleteSection(section)" class="btn btn-danger" ng-disabled="!edit">מחק תחום פעילות זה</button>
        <br />
        </span>
                    </span>
                </div>
            </div>



        </div>
    </script>




    <script type="text/ng-template" id="/format_criterias.html">
        <div>
            <div class="page-header">
                <h1>ASES - ניהול קריטריונים להערכה</h1>
            </div>
            <!-- rest of template -->
            <div ng-hide="isLoggedIn()">
                <h3>You need to <a href="/#/login">Log In</a> or <a href="/#/register">Register</a> before you can enter section
                    manager.
                </h3>
            </div>

            <form ng-submit="addFormatCriteria()" ng-show="isLoggedIn()" style="margin-top:30px;">
                <h3>הוספת קריטריון הערכה חדש</h3>


                <!--<div class="form-group">
                    <input type="num" class="form-control" placeholder="מספר" ng-model="num"></input>
                </div>-->
                <div class="form-group">
                    <input type="text" class="form-control" placeholder="שם" ng-model="name" ng-required="true"></input>
                </div>
                <div class="form-group">
                    <input type="text" class="form-control" placeholder="תיאור" ng-model="slug"></input>
                </div>
                <div class="form-group">
                    <input type="num" class="form-control" placeholder="משקל" ng-model="weight" ng-required="true"></input>
                </div>






                <div>
                    <label>תחום פעילות: <select ng-model="section" ng-options="(section.num+'.'+section.name) for section in sections" value="{{section}}">
                        <option value="">נא לבחור תחום פעילות</option>
                    </select></label>
                </div>







                <div>
                    <input type="button" class="btn btn-info" ng-click="addNewField()" value="הוספת שדה">
                    <div>
                        <fieldset data-ng-repeat="field in fieldSet.fields track by $index">
                            <input ng-model="fieldSet.fields[$index]" />
                            <select ng-model="selectedDataType.value" ng-change="updateDataType($index, selectedDataType.value.value)" ng-options="dataType.placeholder for dataType in dataTypes">
                                <option value="">סוג הקלט:</option>
                            </select>
                            <button type="button" class="btn btn-default btn-sm" ng-click="removeField($index)">
                            <span class="glyphicon glyphicon-minus"></span> הסרת שדה
                            </button>
                        </fieldset>
                    </div>
                </div>

                <br />
                <button type="submit" class="btn btn-primary">הוספה</button>
            </form>



            <!-- EXISTING Format Criterias -->
            <div ng-repeat="formatCriteria in formatCriterias | orderBy:'num'">

                <span style="font-size:20px; margin-left:10px;">
      <span>
        <label class="label-field">מספר: </label>
        <input class="editable-field" ng-model="formatCriteria.num" ng-disabled="!edit" value="{{formatCriteria.num}}">
        <br />
      </span>
                <span>
        <label class="label-field">שם: </label>
        <input class="editable-field" ng-model="formatCriteria.name" ng-disabled="!edit" value="{{formatCriteria.name}}">
        <br />
      </span>
                <span ng-show="formatCriteria.slug || edit">
        <label class="label-field">תיאור: </label>
        <input class="editable-field" ng-model="formatCriteria.slug" ng-disabled="!edit" value="{{formatCriteria.slug}}">
        <br />
        </span>


                <span>
        <label class="label-field">משקל: </label>
        <input class="editable-field" ng-model="formatCriteria.weight" ng-disabled="!edit" value="{{formatCriteria.weight}}" />
        <br />
      </span>



        <span>
        <label class="label-field">תחום פעילות: </label>
        <input class="editable-field" ng-model="formatCriteria.section.num+'.'+formatCriteria.section.name" ng-disabled="true" value="{{formatCriteria.section.num+'.'+formatCriteria.section.name}}" />
        <br />
        </span>



            <div>
                <label>שינוי תחום פעילות: 
                    <select ng-model="formatCriteria.section" ng-options="(section.num+'.'+section.name) for section in sections" ng-disabled="!edit" value="{{section}}">
                    </select>
                </label>
            </div>


                <!--<div>
                    <fieldset data-ng-repeat="dataField in formatCriteria.fields track by $index">
                <input ng-model="formatCriteria.fields[$index]" />
                <select ng-model="selectedDataType.value" ng-change="updateDataType($index, selectedDataType.value.value)" ng-options="dataType.placeholder for dataType in dataTypes">
                    <option value="">סוג הקלט:</option>
                </select>
                <button type="button" class="btn btn-default btn-sm" ng-click="removeField($index)">
                <span class="glyphicon glyphicon-minus"></span> הסרת שדה
                </button>
                </fieldset>
                </div>-->



                <label class="label-field">שדות: </label>
                <div data-ng-repeat="dataField in formatCriteria.fields">
                    <span>
        <label class="label-field"></label>
        <input class="editable-field" ng-model="dataField.name" ng-disabled="!edit" value="{{dataField}}" />
                <br />
                </span>
                </div>





        <span>
       <label>תאריך הוספה:</label> {{formatCriteria.dateCreated | date:'dd/MM/yyyy - HH:mm:ss'}}
       <br />
      </span>
                <span ng-hide="formatCriteria.dateCreated===formatCriteria.dateModified">
         <label>נערך לאחרונה:</label> {{formatCriteria.dateModified | date:'dd/MM/yyyy - HH:mm:ss'}}
         <br />
      </span>

                <span>
        <label>לחץ לעריכה: <input type="checkbox" ng-model="edit"></label>

        <button ng-click="editFormatCriteria($index, formatCriteria)" class="btn btn-primary" ng-disabled="!edit">שמור שינויים</button>
        <button ng-click="deleteFormatCriteria(formatCriteria)" class="btn btn-danger" ng-disabled="!edit">מחק תחום פעילות זה</button>
        <br />
      </span>
                </span>

            </div>
        </div>
    </script>





    <script type="text/ng-template" id="/posts.html">
        <div ng-hide="isLoggedIn()">
            <h3>You need to <a href="/#/login">Log In</a> or <a href="/#/register">Register</a> before you can comment.</h3>
        </div>
        <div class="page-header">
            <h3>
                <a ng-show="post.link" href="{{post.link}}">{{post.title}}</a>
                <span ng-hide="post.link">{{post.title}}</span>
            </h3>
        </div>
        <div ng-repeat="comment in post.comments | orderBy:'-upvotes'">
            <span class="glyphicon glyphicon-thumbs-up" ng-click="incrementUpvotes(comment)"></span> {{comment.upvotes}}
            - by {{comment.author}}
            <span style="font-size:20px; margin-left:10px;">{{comment.body}}
        </div>
        <form ng-submit="addComment()" ng-show="isLoggedIn()" style="margin-top:30px;">
            <h3>Add a new comment</h3>
            <div class="form-group">
                <input type="text" class="form-control" placeholder="Comment" ng-model="body"></input>
            </div>
            <button type="submit" class="btn btn-primary">Post</button>
        </form>
    </script>

    <script type="text/ng-template" id="/register.html">
        <div class="page-header">
            <h1>ASES</h1>
        </div>

        <div ng-show="error" class="alert alert-danger row">
            <span>{{ error.message }}</span>
        </div>

        <form ng-submit="register()" style="margin-top:30px;">
            <h3>Register</h3>

            <div class="form-group">
                <input type="text" class="form-control" placeholder="Username" ng-model="user.username"></input>
            </div>
            <div class="form-group">
                <input type="password" class="form-control" placeholder="Password" ng-model="user.password"></input>
            </div>
            <button type="submit" class="btn btn-primary">Register</button>
        </form>
    </script>

    <script type="text/ng-template" id="/login.html">
        <div class="page-header">
            <h1>ASES</h1>
        </div>

        <div ng-show="error" class="alert alert-danger row">
            <span>{{ error.message }}</span>
        </div>

        <form ng-submit="logIn()" style="margin-top:30px;">
            <h3>Log In</h3>

            <div class="form-group">
                <input type="text" class="form-control" placeholder="Username" ng-model="user.username"></input>
            </div>
            <div class="form-group">
                <input type="password" class="form-control" placeholder="Password" ng-model="user.password"></input>
            </div>
            <button type="submit" class="btn btn-primary">Log In</button>
        </form>
    </script>

</body>

</html>